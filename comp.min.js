/* ____ ____ _  _ ___   
*  |___ [__] |\/| |--' . v1.1.1
* 
* A design pattern and micro-framework for creating UI components
*
* Copyright Brendan Jefferis and other contributors
* Released under the MIT license
* 
* Issues? Please visit https://github.com/brendan-jefferis/comp/issues
*
* Date: 2017-01-02T05:19:58.860Z 
*/
(function(e,n){typeof exports==="object"&&typeof module!=="undefined"?module.exports=n():typeof define==="function"&&define.amd?define(n):e.comp=n()})(this,function(){"use strict";function e(e){try{new Function(e)}catch(e){if(e instanceof SyntaxError){throw new SyntaxError(e)}}}function n(e){e=e||window.event;return e.target||e.srcElement}/* eslint-disable no-nested-ternary */
var r=[];var t=[];var o=function(e,n){if(e===n){return 0}var o=e.length;var a=n.length;if(o===0){return a}if(a===0){return o}var i;var u;var f;var c;var l=0;var d=0;while(l<o){t[l]=e.charCodeAt(l);r[l]=++l}while(d<a){i=n.charCodeAt(d);f=d++;u=d;for(l=0;l<o;l++){c=i===t[l]?f:f+1;f=r[l];u=r[l]=f>u?c>u?u+1:c:c>f?f+1:c}}return u};var a=3;function i(e,n){if(e==null){throw new Error("suggestActions requires a string argument to use as a query")}if(n==null){throw new Error("suggestActions requires a component to search for actions")}var r=[];Object.keys(n).map(function(n){var t=o(e,n);if(t>a){return}r.push({term:n,distance:t})});return r.sort(function(e,n){return e.distance>n.distance})}function u(e){var n=document.querySelector("[data-component="+e.name+"]");if(n===null){return e}Object.keys(Event.prototype).map(function(r,t){if(t>=10&&t<=19){n.addEventListener(r.toLowerCase(),function(r){return f(r,e,n)})}},this);return e}function f(e,r,t){var o=n(e);var a=l(e,o,t);if(a.name===""){return}if(r[a.name]==null){var u=i(a.name,r);var f=u.length?"\r\n\r\nDid you mean\r\n\r\n"+u.map(function(e){return r.name+"."+e.term+"\n"}).join("")+"\r":"";throw new Error("Could not find action "+a.name+" in component "+r.name+f)}if(a.args===""){r[a.name]()}else{r[a.name].apply(a,a.args)}}function c(n,r,t){var o=r.getAttribute("data-"+[n.type])||"";if(o!==""||r===t){try{e(o,r)}catch(e){var a=document.createElement("div");a.appendChild(r.cloneNode(false));throw new SyntaxError("\r\n\r\nElement: "+a.innerHTML+"\r\nEvent: data-"+[n.type]+"\r\nAction: "+o+"\r\n\r\n"+e)}return{name:o,element:r}}return c(n,r.parentNode,t)}function l(e,n,r){var t=c(e,n,r);return{name:d(t.name),args:s(t.name,t.element)}}function d(e){var n=e.match(/[^(]*/);return n?n[0]:""}function s(e,n){var r=/\(\s*([^)]+?)\s*\)/.exec(e);if(!r||r[1]==null){return""}r=r[1].split(/\s*,\s*/).map(function(e){var r=e.split(".");if(r.length===1&&r.indexOf("this")===-1){return e}var t=r.indexOf("dataset")===1?Object.assign({},n.dataset):null;return t?t[r[2]]:n[r[1]]},n);return r}var m=Object.freeze({registerEventDelegator:u,delegateEvent:f,bubbleUntilActionFound:c,getEventActionFromElement:l,extractActionName:d,extractArguments:s});var v=new window.DOMParser;var p="text/html";var h="application/xhtml+xml";var g="<i></i>";var y="HTML";var E=false;var w=false;
// Check if browser supports text/html DOMParser
try{/* istanbul ignore next: Fails in older browsers */
if(v.parseFromString(g,p))E=true}catch(e){}try{/* istanbul ignore next: Only used in ie9 */
if(!E&&v.parseFromString(g,h))w=true}catch(e){}/**
 * Returns the results of a DOMParser as an HTMLElement.
 * (Shims for older browser and IE9).
 */
var N=E?function e(n,r){var t=v.parseFromString(n,p);return r===y?t.documentElement:t.body.firstChild}:function e(n,r){var t=r===y;
// Special case for ie9 (documentElement.innerHTML not supported).
if(w&&t){return v.parseFromString(n,h).documentElement}
// Fallback to innerHTML for other older browsers.
var o=document.implementation.createHTMLDocument("");if(t){o.documentElement.innerHTML=n;return o.documentElement}else{o.body.innerHTML=n;return o.body.firstChild}};var b=N;var x="_set-dom-";var A=x+"index";var C=x+"mounted";var S=window.Node.ELEMENT_NODE;var O=window.Node.DOCUMENT_NODE;j.KEY="data-key";j.IGNORE="data-ignore";j.CHECKSUM="data-checksum";var M=j;/**
 * @description
 * Updates existing dom to match a new dom.
 *
 * @param {Node} prev - The html entity to update.
 * @param {String|Node} next - The updated html(entity).
 */
function j(e,n){
// Ensure a realish dom node is provided.
P(e&&e.nodeType,"You must provide a valid node to update.");
// Alias document element with document.
if(e.nodeType===O)e=e.documentElement;
// If a string was provided we will parse it as dom.
if(typeof n==="string")n=b(n,e.nodeName);
// Update the node.
T(e,n);
// Trigger mount events on initial set.
if(!e[C]){e[C]=true;F(e)}}/**
 * @private
 * @description
 * Updates a specific htmlNode and does whatever it takes to convert it to another one.
 *
 * @param {Node} prev - The previous HTMLNode.
 * @param {Node} next - The updated HTMLNode.
 */
function T(e,n){if(e.nodeType===n.nodeType){
// Handle regular element node updates.
if(e.nodeType===S){
// Ignore elements if their checksum matches.
if(k(e)===k(n))return;
// Ignore elements that explicity choose not to be diffed.
if(D(e)&&D(n))return;
// Update all children (and subchildren).
_(e,e.childNodes,n.childNodes);
// Update the elements attributes / tagName.
if(e.nodeName===n.nodeName){
// If we have the same nodename then we can directly update the attributes.
H(e,e.attributes,n.attributes)}else{
// Otherwise clone the new node to use as the existing node.
var r=n.cloneNode();
// Copy over all existing children from the original node.
while(e.firstChild)r.appendChild(e.firstChild);
// Replace the original node with the new one with the right tag.
e.parentNode.replaceChild(r,e)}}else{
// Handle other types of node updates (text/comments/etc).
// If both are the same type of node we can update directly.
if(e.nodeValue!==n.nodeValue){e.nodeValue=n.nodeValue}}}else{
// we have to replace the node.
q(e);e.parentNode.replaceChild(n,e);F(n)}}/**
 * @private
 * @description
 * Utility that will update one list of attributes to match another.
 *
 * @param {Node} parent - The current parentNode being updated.
 * @param {NamedNodeMap} prev - The previous attributes.
 * @param {NamedNodeMap} next - The updated attributes.
 */
function H(e,n,r){var t,o,a,i,u;
// Remove old attributes.
for(t=n.length;t--;){o=n[t];i=o.namespaceURI;u=o.localName;a=r.getNamedItemNS(i,u);if(!a)n.removeNamedItemNS(i,u)}
// Set new attributes.
for(t=r.length;t--;){o=r[t];i=o.namespaceURI;u=o.localName;a=n.getNamedItemNS(i,u);if(!a){
// Add a new attribute.
r.removeNamedItemNS(i,u);n.setNamedItemNS(o)}else if(a.value!==o.value){
// Update existing attribute.
a.value=o.value}}}/**
 * @private
 * @description
 * Utility that will update one list of childNodes to match another.
 *
 * @param {Node} parent - The current parentNode being updated.
 * @param {NodeList} prevChildNodes - The previous children.
 * @param {NodeList} nextChildNodes - The updated children.
 */
function _(e,n,r){var t,o,a,i,u;
// Convert nodelists into a usuable map.
var f=I(n);var c=I(r);
// Remove old nodes.
for(t in f){if(c[t])continue;
// Trigger custom dismount event.
q(f[t]);
// Remove child from dom.
e.removeChild(f[t])}
// Set new nodes.
for(t in c){o=f[t];a=c[t];
// Extract the position of the new node.
i=a[A];if(o){
// Update an existing node.
T(o,a);
// Check if the node has moved in the tree.
if(o[A]===i)continue;
// Get the current element at the new position.
/* istanbul ignore next */
u=n[i]||null;// TODO: figure out if || null is needed.
// Check if the node has already been properly positioned.
if(u===o)continue;
// Reposition node.
e.insertBefore(o,u)}else{
// Get the current element at the new position.
u=n[i]||null;
// Append the new node at the correct position.
e.insertBefore(a,u);
// Trigger custom mounted event.
F(a)}}}/**
 * @private
 * @description
 * Converts a nodelist into a keyed map.
 * This is used for diffing while keeping elements with 'data-key' or 'id' if possible.
 *
 * @param {NodeList} childNodes - The childNodes to convert.
 * @return {Object}
 */
function I(e){var n={};var r=e.length;var t;for(var o=0;o<r;o++){t=e[o];t[A]=o;n[L(t)||o]=t}return n}/**
 * @private
 * @description
 * Utility to try to pull a key out of an element.
 * Uses 'data-key' if possible and falls back to 'id'.
 *
 * @param {Node} node - The node to get the key for.
 * @return {String}
 */
function L(e){if(e.nodeType!==S)return;var n=e.getAttribute(j.KEY)||e.id;if(n)n=x+n;return n&&x+n}/**
 * @private
 * @description
 * Utility to try to pull a checksum attribute from an element.
 * Uses 'data-checksum' or user specified checksum property.
 *
 * @param {Node} node - The node to get the checksum for.
 * @return {String|NaN}
 */
function k(e){return e.getAttribute(j.CHECKSUM)||NaN}/**
 * @private
 * @description
 * Utility to try to check if an element should be ignored by the algorithm.
 * Uses 'data-ignore' or user specified ignore property.
 *
 * @param {Node} node - The node to check if it should be ignored.
 * @return {Boolean}
 */
function D(e){return e.getAttribute(j.IGNORE)!=null}/**
 * Recursively trigger a mount event for a node and it's children.
 *
 * @param {Node} node - the initial node to be mounted.
 */
function F(e){
// Trigger mount event for this element if it has a key.
if(L(e))U(e,"mount");
// Mount all children.
var n=e.firstChild;while(n){F(n);n=n.nextSibling}}/**
 * Recursively trigger a dismount event for a node and it's children.
 *
 * @param {Node} node - the initial node to be dismounted.
 */
function q(e){
// Dismount all children.
var n=e.firstChild;while(n){q(n);n=n.nextSibling}
// Trigger dismount event for this element if it has a key.
if(L(e))U(e,"dismount")}/**
 * @private
 * @description
 * Create and dispatch a custom event.
 *
 * @param {Node} el - the node to dispatch the event for.
 * @param {String} type - the name of the event.
 */
function U(e,n){var r=document.createEvent("Event");var t={value:e};r.initEvent(n,false,false);Object.defineProperty(r,"target",t);Object.defineProperty(r,"srcElement",t);e.dispatchEvent(r)}/**
 * @private
 * @description
 * Confirm that a value is truthy, throws an error message otherwise.
 *
 * @param {*} val - the val to test.
 * @param {String} msg - the error message on failure.
 * @throws Error
 */
function P(e,n){if(!e)throw new Error("set-dom: "+n)}function R(e){return e&&e.__esModule?e["default"]:e}function Y(e,n){return n={exports:{}},e(n,n.exports),n.exports}var K=Y(function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});var r={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;","`":"&#96;"};var t=new RegExp(Object.keys(r).join("|"),"g");n["default"]=function(){var e=arguments.length<=0||arguments[0]===undefined?"":arguments[0];return String(e).replace(t,function(e){return r[e]})};e.exports=n["default"]});var V=Y(function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});function r(e){return e&&e.__esModule?e:{default:e}}var t=K;var o=r(t);n["default"]=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),t=1;t<n;t++){r[t-1]=arguments[t]}return e.raw.reduce(function(e,n,t){var a=r[t-1];if(Array.isArray(a)){a=a.join("")}else{a=(0,o["default"])(a)}return e+a+n})};e.exports=n["default"]});var B=R(V);var G={};function z(e,n,r,t){r(t);var o={};Object.keys(n).map(function(e){o[e]=function(){for(var o=arguments.length,a=Array(o),i=0;i<o;i++){a[i]=arguments[i]}var u=n[e].apply(n,a);if(u&&u.then){J(u,r)}r(t)}},this);o.name=e;o.get=function(e){return t[e]};return o}function J(e,n){e.then(function(e){if(e==null){throw new Error("No model received: aborting render")}n(e)}).catch(function(e){if(typeof e==="string"){console.error(e)}else{console.error("Error unhandled by component. Add a catch handler to your AJAX method.")}})}function X(e,n,r,t){if(e==null||e===""){throw new Error("Your component needs a name")}if(n==null){var o="// It must be a function that takes a model and returns an object of functions, e.g.\r\n\r\nYourComponent.Actions = function (model) {\r\n    return {\r\n        sayHello: function () { console.log('Hi.'); },\r\n        greet: function (name) { console.log('Hello, ' + name); }\r\n    }\r\n}";throw new Error(e+" needs some actions! Here's an example of an Actions function:\r\n\r\n"+o+"\r\n\r\n")}var a=r&&r();var i=a&&a.init?a.init:function(){};var f=a&&a.render?function(n){var r=a.render(n,B);if(typeof document!=="undefined"&&r){var t=document.querySelector("[data-component="+e+"]");if(t){if(t.innerHTML===""){t.innerHTML=r}else{M(t.firstElementChild,r)}}}}:function(){};var c=z(e,n(t),f,t);G[e]=c;if(typeof document!=="undefined"&&typeof m!=="undefined"){c=u(c)}i(c,t);return c}var Q={components:G,create:X};return Q});
//# sourceMappingURL=comp.min.js.map