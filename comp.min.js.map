{"version":3,"sources":["src/comp.js"],"names":[],"mappings":"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","file":"comp.min.js","sourcesContent":["class Comp {\r\n    constructor() {\r\n        this.components = {};\r\n    }\r\n    // createRecorder(actions, view = ()=>{}) {\r\n    //     let path = window.location.pathname;\r\n    //     let model = {\r\n    //         pageLoadTimestamp: Date.now(),\r\n    //         steps: [],\r\n    //         components: {},\r\n    //         recording: true,\r\n    //         sessionName: path.substr(1, path.indexOf('.')-1).split('/').join('_')\r\n    //     };\r\n    //     this.recorder = new Component(\"recorder\", actions, view, model);\r\n    // }\r\n\r\n    create(componentName, actions, view = ()=>{}, model = {}) {\r\n        this.components[componentName] = new Component(componentName, actions, view, model);\r\n    }\r\n}\r\n\r\nclass Component {\r\n    constructor (componentName, actions, view, model) {\r\n        if (componentName == null || componentName === \"\") {\r\n            throw new Error(\"Your component needs a name\");\r\n        }\r\n\r\n        if (actions == null) {\r\n            const example = \"// It must be a function that takes a model and returns an object of functions, e.g.\\r\\n\\r\\nYourComponent.Actions = function (model) {\\r\\n    return {\\r\\n        sayHello: function () { console.log('Hi.'); },\\r\\n        greet: function (name) { console.log('Hello, ' + name); }\\r\\n    }\\r\\n}\";\r\n            throw new Error(`${componentName} needs some actions! Here's an example of an Actions function:\\r\\n\\r\\n${example}\\r\\n\\r\\n`);\r\n        }\r\n\r\n        this.componentName = componentName;\r\n\r\n        let _view = view && view();\r\n        let viewInit = _view && _view.init ? _view.init : () => {};\r\n        let viewRender = _view && _view.render ? _view.render : () => {};\r\n\r\n        Object.assign(this, this.componentize(actions(model), viewRender, model));\r\n        viewInit(this, model);\r\n\r\n        // if (componentizer.recorder && componentName !== \"recorder\") {\r\n        //     componentizer.recorder.storeComponent(this, model);\r\n        // }\r\n    }\r\n\r\n    componentize(actions, render, model) {\r\n        let html = render(model);\r\n        let cachedHtml = html;\r\n        if (typeof document !== \"undefined\" && html) {\r\n            document.querySelector(`[data-component=${this.componentName}]`).innerHTML = html;\r\n        }\r\n        let component = {};\r\n        Object.keys(actions).map((action) => {\r\n            component[action] = (...args) => {\r\n\r\n                let returnValue = actions[action].apply(actions, args);\r\n\r\n                // if (componentizer.recorder && componentName !== \"recorder\" && componentizer.recorder.get(\"recording\")) {\r\n                //     componentizer.recorder.recordStep(componentName, model, action, args);\r\n                // }\r\n\r\n                if (returnValue && returnValue.then) {\r\n                    this.handlePromise(returnValue, render);\r\n                }\r\n                html = render(model);\r\n                if (typeof document !== \"undefined\" && html && html !== cachedHtml) {\r\n                    document.querySelector(`[data-component=${this.componentName}]`).innerHTML = html;\r\n                    cachedHtml = html;\r\n                }\r\n            }\r\n        }, this);\r\n        component.get = (prop) => model[prop];\r\n\r\n        if (typeof document !== \"undefined\") {\r\n            this.registerEventDelegation(this.componentName, component);\r\n        }\r\n        return component;\r\n    }\r\n\r\n    handlePromise(promise, render) {\r\n        promise\r\n            .then((updatedModel)=> {\r\n                if (updatedModel == null) {\r\n                    throw new Error(\"No model received: aborting render\");\r\n                }\r\n                render(updatedModel);\r\n            })\r\n            .catch((err) => {\r\n                if (typeof err === \"string\") {\r\n                    console.error(err);\r\n                } else {\r\n                    console.error(`Error unhandled by component. Add a catch handler to your AJAX method.`);\r\n                }\r\n            });\r\n    }\r\n\r\n    registerEventDelegation(name, actions) {\r\n        const componentHtmlTarget = document.querySelector(`[data-component=${name}]`);\r\n        if (componentHtmlTarget === null) {\r\n            return;\r\n        }\r\n\r\n        Object.keys(Event.prototype).map(function (ev, i) {\r\n            if (i >= 10 && i <= 19) {\r\n                componentHtmlTarget.addEventListener(ev.toLowerCase(), e => {\r\n                    const target = this.getTarget(e);\r\n                    const action = this.getAction(e, target);\r\n                    if (actions[action.name] == null) {\r\n                        return;\r\n                    }\r\n\r\n                    if (action.args === \"\") {\r\n                        actions[action.name]();\r\n                    } else {\r\n                        actions[action.name].apply(action, action.args);\r\n                    }\r\n                });\r\n            }\r\n        }, this);\r\n    }\r\n\r\n    getTarget(e) {\r\n        e = e || window.event;\r\n        return e.target || e.srcElement;\r\n    }\r\n\r\n    getAction(e, target) {\r\n        const actionStr = target.dataset[e.type] || \"\";\r\n\r\n        return {\r\n            name: this.getActionName(actionStr),\r\n            args: this.extractArgs(actionStr, target)\r\n        }\r\n    }\r\n\r\n    getActionName(actionStr) {\r\n        const nameResult = actionStr.match(/[^(]*/);\r\n        return nameResult ? nameResult[0] : \"\";\r\n    }\r\n\r\n    extractArgs(actionStr, target) {\r\n        let args = /\\(\\s*([^)]+?)\\s*\\)/.exec(actionStr);\r\n        if (!args || args[1] == null) {\r\n            return \"\";\r\n        }\r\n\r\n        args = args[1].split(/\\s*,\\s*/).map(function (arg) {\r\n            return arg.match(/(value)/) ? this.value : arg;\r\n        }, target);\r\n\r\n        return args;\r\n    }\r\n}\r\n\r\nlet comp = new Comp();\r\n\r\nif (typeof exports != 'undefined' && !exports.nodeType) {\r\n    if (typeof module != 'undefined' && !module.nodeType && module.exports) {\r\n        exports = module.exports = comp;\r\n    }\r\n} else {\r\n    window.comp = comp;\r\n}"]}